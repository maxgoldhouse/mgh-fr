{{ define "head" }}
<link href="https://cdnjs.cloudflare.com/ajax/libs/slim-select/1.27.1/slimselect.min.css" rel="stylesheet"></link>
<script src="https://cdnjs.cloudflare.com/ajax/libs/slim-select/1.27.1/slimselect.min.js"></script>
<script src="https://kit.fontawesome.com/73fe5491f6.js" crossorigin="anonymous"></script>
    
{{ end }}

{{ define "header" }}
 
{{ end }}

{{ define "main" }} 
<script>
  const params = new URLSearchParams(window.location.search);
  function displaysearch(action){
    document.getElementById("fpphoto").style.display=action;
    document.getElementById("opensearch").style.display=(action == 'block') ? 'none' : 'block';//toggle the filter search button
    document.getElementById("closesearch").style.display=(action == 'none') ? 'none' : 'block';//toggle the filter search button
  }
  </script>
  <div id="opensearch">
    <div class="columns is-centered">
      <div class="column is-12" style="padding:1.3rem 0;">  
        <center><button id="opensearchbtn" onclick="displaysearch('block')" style="border-radius:50%;" class="button is-info details" title="Modifier vos paramètres de recherche"><i class="fas fa-search" aria-hidden="true"></i>&nbsp;<i class="fas fa-plus" aria-hidden="true"></i></button></center>
       </div>
    </div>
  </div>
  <div class="columns is-centered">
      <div class="column"id="fpphoto" style="display:none;">
        <div class="" id="searchformholder">
  
            <form id="propsearch" action="" method="GET">
                <div class="columns xis-vcentered is-multiline is-centered">
                    <br/>
                     <div class="locs column is-2 is-inline-block-mobile">
                        <div class="field">
                            <label class="label is-small has-text-white popwhitetext"><br/>Locale <span class="slimreset" onclick="theloc.set([])">Réinitialiser</span></label>
                            <select id="loc" class="slim-hidden" name="loc" multiple="multiple">
                              {{ partial "alllocations.html" . }}
                            </select>

                        </div>
                    </div>
                  <script>
                      arrlocs = params.getAll('loc')
                      var theloc = new SlimSelect({
                      select: '#loc',
                      showSearch: false,
                      selectByGroup: true,
                      placeholder: 'Sélectionnez dans la liste',
                      allowDeselect: true
                      })
                      theloc.set(arrlocs)
                  </script>
                    <div class="type column is-inline-block-mobile is-2 is-5-mobile">
                        <div class="field">
                            <label class="label is-small has-text-white popwhitetext"><br/>Type de propriété</label>
                            
                            <div class="control">
                                <select name="pt" class="slim-hidden" id="pt" aria-label="Property type" readonly=""  multiple="multiple">
                                    <option value=""></option>
                                    <option value="Apartment">Appartement</option>  
                                    <option value="Townhouse">Maison mitoyenne</option>
                                    <option value="Villa">Villa</option>
                                    <option value="Finca">Maison de campagne</option>
                                    <option value="Land">Terraine</option>
                                    <option value="Commercial">Batiment Commercial</option>
                                </select>
                            </div>
                        </div>
                    </div>
                  <script>
                    var thept = new SlimSelect({
                    select: '#pt',
                    showSearch: false,
                    placeholder: 'Sélectionnez dans la liste',
                    allowDeselect: true
                  })
                    var thecontrols = document.getElementsByClassName("ss-main");
                    thecontrols[0].style.visibility = "visible";
                    thecontrols[1].style.visibility = "visible";
                  </script>
                    <div class="anrr column is-inline-block-mobile is-3 is-6-mobile">
                        <div class="field">
                            <label class="label is-small has-text-white popwhitetext"><br>Nouvelle/revente/louer</label>
                            <select id="offeris" class="form-control" name="offeris">
                                <option value="all">tout</option>
                                <option value="new">Nouvelle</option>
                                <option value="resale">revente</option>
                                </select>
                        </div>
                    </div>
                    <script>
                        function poolchecked(){
                          if(document.getElementById("pool").checked){
                            document.getElementById("poolvalue").value = 'true';
                            document.getElementById("pool").value = 'on';}
                          else{
                            document.getElementById("poolvalue").value = 'false';
                            document.getElementById("pool").value = '';}                               
                          }
                    </script>
                    <div class="pool column" style="max-width: 60px;">
                        <div class="field">
                            <label class="label is-small has-text-white popwhitetext"><br/>Piscine</label>
                            <div class="control">                             
                                  <input class="form-control poolcheckbox" type="checkbox" name="pool" id="pool" onchange="poolchecked()" >
  
                                  <input type="hidden" id="poolvalue" value="false"/>
                            </div>
                        </div>
                     </div>
  
  
                  </div>
                  <div class="columns is-multiline is-centered">
                    <div class="beds column is-inline-block is-1 is-5-mobile">
                        <div class="field">
                            <label class="label is-small has-text-white popwhitetext"><br/>Chambres</label>
                            <div class="control">                             
                                  <select name="beds" class="form-control" id="beds" aria-label="Chambres a coucher" readonly="">
                                    <option value=""></option>
                                    <option value="0">0</option>
                                    <option value="1">1</option>
                                    <option value="1m">1+</option>
                                    <option value="2">2</option>
                                    <option value="2m">2+</option>
                                    <option value="3">3</option>
                                    <option value="3m">3+</option>
                                    <option value="4">4</option>
                                    <option value="4m">4+</option>
                                    <option value="5">5</option>
                                    <option value="5m">5+</option>                                                                    
                                </select>
                            </div>
                        </div>
                    </div>
                    <div class="baths column is-inline-block is-1 is-5-mobile">
                        <div class="field">
                            <label class="label is-small has-text-white popwhitetext"><br/>Salles de bain</label>
                            <div class="control">                             
                                  <select name="baths" class="form-control" id="baths" aria-label="Salles de bain" readonly="">
                                    <option value=""></option>
                                    <option value="0">0</option>
                                    <option value="1">1</option>
                                    <option value="2">2</option>
                                    <option value="3">3</option>
                                    <option value="4">4</option>
                                    <option value="5">5</option>
                                    <option value="6">6</option>
                                    <option value="7">7</option>
                                    <option value="8">8</option>
                                    <option value="9">9</option>
                                    <option value="10">10</option>
                                    <option value="11">11</option>
                                    <option value="12">12</option>                                                                   
                                </select>
                            </div>
                        </div>
                    </div>                  
                    <div class="min column is-inline-block is-2 is-5-mobile">
                        <div class="field">
                            <label class="label is-small has-text-white popwhitetext"><br/>€ prix min</label>
                            <div class="control">
                                <select name="gtp" class="form-control" id="gtp" aria-label="prix min" readonly="">                                 
                                    <option value=""></option>
                                    <option value="0">€0</option>
                                    <option value="50000">€50,000</option>
                                    <option value="60000">€60,000</option>
                                    <option value="70000">€70,000</option>
                                    <option value="80000">€80,000</option>
                                    <option value="90000">€90,000</option>
                                    <option value="100000">€100,000</option>
                                    <option value="125000">€125,000</option>
                                    <option value="150000">€150,000</option>
                                    <option value="175000">€175,000</option>
                                    <option value="200000">€200,000</option>
                                    <option value="225000">€225,000</option>
                                    <option value="250000">€250,000</option>
                                    <option value="275000">€275,000</option>
                                    <option value="300000">€300,000</option>
                                    <option value="325000">€325,000</option>
                                    <option value="350000">€350,000</option>
                                    <option value="375000">€375,000</option>
                                    <option value="400000">€400,000</option>
                                    <option value="425000">€425,000</option>
                                    <option value="450000">€450,000</option>
                                    <option value="475000">€475,000</option>
                                    <option value="500000">€500,000</option>
                                    <option value="550000">€550,000</option>
                                    <option value="600000">€600,000</option>
                                    <option value="650000">€650,000</option>
                                    <option value="700000">€700,000</option>
                                    <option value="800000">€800,000</option>
                                    <option value="900000">€900,000</option>
                                    <option value="1000000">€1,000,000</option>
                                    <option value="1250000">€1,250,000</option>
                                    <option value="1500000">€1,500,000</option>
                                    <option value="1750000">€1,750,000</option>
                                    <option value="2000000">€2,000,000</option>
                                    <option value="2500000">€2,500,000</option>
                                    <option value="3000000">€3,000,000</option>
                                    <option value="4000000">€4,000,000</option>
                                    <option value="5000000">€5,000,000</option>
                                    <option value="7500000">€7,500,000</option>
                                    <option value="10000000">€10,000,000</option>
                                    <option value="15000000">€15,000,000</option>
                                    <option value="20000000">€20,000,000</option>
                                </select>
                            </div>
                        </div>
                    </div>
                    <div class="max column is-inline-block is-2 is-5-mobile">
                        <div class="field">
                            <label class="label is-small has-text-white popwhitetext"><br/>€ prix max</label>
                            <div class="control">
                                <select name="ltp" class="form-control" id="ltp" aria-label="prix max" readonly="">
                                    <option value=""></option>
                                    <option value="50000">€50,000</option>
                                    <option value="60000">€60,000</option>
                                    <option value="70000">€70,000</option>
                                    <option value="80000">€80,000</option>
                                    <option value="90000">€90,000</option>
                                    <option value="100000">€100,000</option>
                                    <option value="125000">€125,000</option>
                                    <option value="150000">€150,000</option>
                                    <option value="175000">€175,000</option>
                                    <option value="200000">€200,000</option>
                                    <option value="225000">€225,000</option>
                                    <option value="250000">€250,000</option>
                                    <option value="275000">€275,000</option>
                                    <option value="300000">€300,000</option>
                                    <option value="325000">€325,000</option>
                                    <option value="350000">€350,000</option>
                                    <option value="375000">€375,000</option>
                                    <option value="400000">€400,000</option>
                                    <option value="425000">€425,000</option>
                                    <option value="450000">€450,000</option>
                                    <option value="475000">€475,000</option>
                                    <option value="500000">€500,000</option>
                                    <option value="550000">€550,000</option>
                                    <option value="600000">€600,000</option>
                                    <option value="650000">€650,000</option>
                                    <option value="700000">€700,000</option>
                                    <option value="800000">€800,000</option>
                                    <option value="900000">€900,000</option>
                                    <option value="1000000">€1,000,000</option>
                                    <option value="1250000">€1,250,000</option>
                                    <option value="1500000">€1,500,000</option>
                                    <option value="1750000">€1,750,000</option>
                                    <option value="2000000">€2,000,000</option>
                                    <option value="2500000">€2,500,000</option>
                                    <option value="3000000">€3,000,000</option>
                                    <option value="4000000">€4,000,000</option>
                                    <option value="5000000">€5,000,000</option>
                                    <option value="7500000">€7,500,000</option>
                                    <option value="10000000">€10,000,000</option>
                                    <option value="15000000">€15,000,000</option>
                                    <option value="20000000">€20,000,000</option>
                                </select>
                            </div>
                        </div>
                    </div>
  
                    <div class="refs column is-2">
                         <div class="field">
                            <label class="label is-small has-text-white popwhitetext"><br/>Ref-No.</label>
                            <div class="control">                             
                                  <select class="form-control" name="propref"><option value="No Ref">Sélectionnez</option><option value="No Ref">Sélectionnez</option><option value="00-0011">00-0011</option><option value="00-0019">00-0019</option><option value="00-0026">00-0026</option><option value="00-0028">00-0028</option><option value="00-0033">00-0033</option><option value="00-0047">00-0047</option><option value="00-0050">00-0050</option><option value="00-0054">00-0054</option><option value="00-0055">00-0055</option><option value="00-0064">00-0064</option><option value="00-0066">00-0066</option><option value="00-0068">00-0068</option><option value="00-0072">00-0072</option><option value="00-0073">00-0073</option><option value="00-0074">00-0074</option><option value="00-0075">00-0075</option><option value="00-0076">00-0076</option><option value="00-0077">00-0077</option><option value="00-6062">00-6062</option><option value="00-6106">00-6106</option><option value="00-7146">00-7146</option><option value="00-7290">00-7290</option><option value="00-7520">00-7520</option><option value="00-7666">00-7666</option><option value="01-0321">01-0321</option><option value="01-0385">01-0385</option><option value="01-6054">01-6054</option><option value="03-5075">03-5075</option><option value="05-0137">05-0137</option><option value="05-0171">05-0171</option><option value="05-0172">05-0172</option><option value="05-0205">05-0205</option><option value="05-0245">05-0245</option><option value="10-0064">10-0064</option><option value="10-0529">10-0529</option><option value="10-0555">10-0555</option><option value="13-1362">13-1362</option><option value="13-2474">13-2474</option><option value="16-4193">16-4193</option><option value="18-8311">18-8311</option><option value="20-1045">20-1045</option><option value="21-6217">21-6217</option><option value="27-1246">27-1246</option><option value="30-0599">30-0599</option><option value="30-0724">30-0724</option><option value="30-0725">30-0725</option><option value="30-0735">30-0735</option><option value="31-3132">31-3132</option><option value="31-3133">31-3133</option><option value="31-3192">31-3192</option><option value="31-3901">31-3901</option><option value="40-1595">40-1595</option><option value="40-1725">40-1725</option><option value="41-3363">41-3363</option><option value="41-4254">41-4254</option><option value="41-7160">41-7160</option><option value="41-9213">41-9213</option><option value="44-2497">44-2497</option><option value="61-1153">61-1153</option><option value="61-1154">61-1154</option><option value="62-1163">62-1163</option><option value="69-0089">69-0089</option><option value="69-0295">69-0295</option><option value="71-0378">71-0378</option><option value="71-0389">71-0389</option><option value="71-0842">71-0842</option><option value="74-0008">74-0008</option><option value="NEW-0004">NEW-0004</option><option value="NEW-0005">NEW-0005</option><option value="NEW-00066a">NEW-00066a</option><option value="NEW-00066b">NEW-00066b</option><option value="NEW-00088">NEW-00088</option><option value="NEW-0022">NEW-0022</option><option value="NEW-0036">NEW-0036</option><option value="NEW-0041">NEW-0041</option><option value="NEW-0053">NEW-0053</option><option value="NEW-0062">NEW-0062</option><option value="NEW-0064">NEW-0064</option><option value="NEW-0067">NEW-0067</option><option value="NEW-0071">NEW-0071</option><option value="NEW-0074">NEW-0074</option><option value="NEW-0077">NEW-0077</option><option value="NEW-0078">NEW-0078</option><option value="NEW-0081">NEW-0081</option><option value="NEW-0085">NEW-0085</option><option value="NEW-0086">NEW-0086</option><option value="NEW-0087">NEW-0087</option><option value="NEW-0097">NEW-0097</option><option value="NEW-0098">NEW-0098</option><option value="NEW-0101">NEW-0101</option><option value="NEW-0108">NEW-0108</option><option value="NEW-0116">NEW-0116</option><option value="NEW-0118">NEW-0118</option><option value="NEW-0119">NEW-0119</option><option value="NEW-0123">NEW-0123</option><option value="NEW-0123a">NEW-0123a</option><option value="NEW-0124">NEW-0124</option><option value="NEW-0125">NEW-0125</option><option value="NEW-0126">NEW-0126</option><option value="NEW-0130">NEW-0130</option><option value="NEW-0131">NEW-0131</option><option value="NEW-0134">NEW-0134</option><option value="NEW-0135">NEW-0135</option><option value="NEW-0135a">NEW-0135a</option><option value="NEW-0136">NEW-0136</option><option value="NEW-0138">NEW-0138</option><option value="NEW-0139">NEW-0139</option><option value="NEW-0141">NEW-0141</option><option value="NEW-0142">NEW-0142</option><option value="NEW-0143">NEW-0143</option><option value="NEW-0145">NEW-0145</option><option value="NEW-0146">NEW-0146</option><option value="NEW-0148">NEW-0148</option><option value="NEW-0149">NEW-0149</option><option value="NEW-0150">NEW-0150</option><option value="NEW-0151">NEW-0151</option><option value="NEW-0153">NEW-0153</option><option value="NEW-0154">NEW-0154</option><option value="NEW-0155">NEW-0155</option><option value="NEW-0157">NEW-0157</option><option value="NEW-0158">NEW-0158</option><option value="NEW-0159">NEW-0159</option><option value="NEW-0160">NEW-0160</option><option value="NEW-0161">NEW-0161</option><option value="NEW-0164">NEW-0164</option><option value="NEW-0165">NEW-0165</option><option value="NEW-0167">NEW-0167</option><option value="NEW-0168">NEW-0168</option><option value="NEW-0169">NEW-0169</option><option value="NEW-0171">NEW-0171</option><option value="NEW-0172">NEW-0172</option><option value="NEW-0175">NEW-0175</option><option value="NEW-0176">NEW-0176</option><option value="NEW-0177">NEW-0177</option><option value="NEW-0178">NEW-0178</option><option value="NEW-0179">NEW-0179</option><option value="NEW-0180">NEW-0180</option><option value="NEW-0181">NEW-0181</option><option value="NEW-0182">NEW-0182</option><option value="NEW-0185">NEW-0185</option><option value="NEW-0186">NEW-0186</option><option value="NEW-0187">NEW-0187</option><option value="NEW-0188">NEW-0188</option><option value="NEW-0189">NEW-0189</option><option value="NEW-0192">NEW-0192</option><option value="NEW-0193">NEW-0193</option><option value="NEW-0194">NEW-0194</option><option value="NEW-0195b">NEW-0195b</option><option value="NEW-0196">NEW-0196</option><option value="NEW-0197">NEW-0197</option><option value="NEW-0198">NEW-0198</option><option value="NEW-0199">NEW-0199</option><option value="NEW-0200">NEW-0200</option><option value="NEW-0201">NEW-0201</option><option value="NEW-0202">NEW-0202</option><option value="NEW-0203">NEW-0203</option><option value="NEW-0204">NEW-0204</option><option value="NEW-0205a">NEW-0205a</option><option value="NEW-0205b">NEW-0205b</option><option value="NEW-0206">NEW-0206</option><option value="NEW-0207">NEW-0207</option><option value="NEW-0208">NEW-0208</option><option value="NEW-0210">NEW-0210</option><option value="NEW-0211">NEW-0211</option><option value="NEW-0212">NEW-0212</option><option value="NEW-0213">NEW-0213</option><option value="NEW-0214">NEW-0214</option><option value="NEW-0215a">NEW-0215a</option><option value="NEW-0215b">NEW-0215b</option><option value="NEW-0216">NEW-0216</option><option value="NEW-0217">NEW-0217</option><option value="NEW-0219">NEW-0219</option><option value="NEW-0220">NEW-0220</option><option value="NEW-0221">NEW-0221</option><option value="NEW-0222a">NEW-0222a</option><option value="NEW-0222b">NEW-0222b</option><option value="NEW-0223">NEW-0223</option><option value="NEW-0224">NEW-0224</option><option value="NEW-0225">NEW-0225</option><option value="NEW-0226">NEW-0226</option><option value="NEW-0227">NEW-0227</option><option value="NEW-0228a">NEW-0228a</option><option value="NEW-0228b">NEW-0228b</option><option value="NEW-0229">NEW-0229</option><option value="NEW-0230">NEW-0230</option><option value="NEW-0231">NEW-0231</option><option value="NEW-0232">NEW-0232</option><option value="NEW-0233">NEW-0233</option><option value="NEW-0234">NEW-0234</option><option value="NEW-0235">NEW-0235</option><option value="NEW-0236">NEW-0236</option><option value="NEW-0237">NEW-0237</option><option value="NEW-0238">NEW-0238</option><option value="NEW-0239">NEW-0239</option><option value="NEW-0240">NEW-0240</option><option value="NEW-7141a">NEW-7141a</option><option value="NEW-7141b">NEW-7141b</option><option value="NEW-7281">NEW-7281</option><option value="NEW-7322">NEW-7322</option><option value="NEW-7322a">NEW-7322a</option><option value="NEW-7355b">NEW-7355b</option><option value="NEW-7369">NEW-7369</option><option value="NEW-7491">NEW-7491</option><option value="NEW-7588">NEW-7588</option><option value="NEW-7590">NEW-7590</option><option value="NEW-7600">NEW-7600</option><option value="NEW-7605">NEW-7605</option><option value="NEW-7608">NEW-7608</option><option value="NEW-7651">NEW-7651</option><option value="NEW-7656">NEW-7656</option><option value="NEW-7661">NEW-7661</option><option value="NEW-7672">NEW-7672</option></select>
                            </div>
                        </div>
                     </div>
                </div>
                <div class="submit columns is-multiline is-centered" style="margin: 1rem 0;">
                    <div class="column" id="searchbutton" style="flex:none;">
                        <input class="button is-info details" type="submit" value="Rechercher">
                    </div>
                </div>
  
  
            </form>
      <div class="columns is-centered" id="closesearch">
      <div class="column is-12">  
        <center><button id="closesearchbtn" onclick="displaysearch('none')" style="border-radius:50%;" class="button is-info details" title="Fermer le formulaire de recherche"><i class="fas fa-times" aria-hidden="true"></i></button></center>
       </div>
    </div>
        </div>
      </div>
    </div>
            <!-- ##### END of Nav and Search ##### -->
                    <script>
                    /* When the user clicks on the button, 
                    toggle between hiding and showing the dropdown content */
                    function myFunction() {
                        document.getElementById("myDropdown").classList.toggle("show");
                    }
  
                    </script>
      <div>
        <div id="propresults" class="columns is-multiline is-mobile search-mania">
          <center><h2 style="text-transform: uppercase;">Recherche de propriété....</h2></center>
        </div>
      </div>
  

  
  <!--[if lt IE 9]>
  <script src="//cdnjs.cloudflare.com/ajax/libs/respond.js/1.4.2/respond.js"></script>
  <![endif]-->
  <script src="//ajax.googleapis.com/ajax/libs/jquery/2.1.1/jquery.min.js"></script>
  <!--[if lte IE 9]>
  <script src="/js/jquery.html5-placeholder-shim.js" type="text/javascript"></script>
  <![endif]-->
  
  <script src="{{ .Site.Params.host}}/js/tengine.js"></script>
  <!-- Latest compiled and minified JavaScript -->
  
  <script src="//cdnjs.cloudflare.com/ajax/libs/taffydb/2.7.3/taffy-min.js"></script>
  <!-- template engine -->
  <script src="{{ .Site.Params.host}}/js/tengine.js"></script>
  <script>
  if(document.location.search){
   document.querySelectorAll('a[class="addqs"], link[rel="alternate"]').forEach(function(userItem) {
     userItem.href = userItem.href+document.location.search;
   });
  };
  
    (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
    (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
    m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
    })(window,document,'script','//www.google-analytics.com/analytics.js','ga');
  
    ga('create', 'UA-140979-2', 'auto');
    ga('require', 'linkid', 'linkid.js');
    ga('send', 'pageview');
  
    function goback(fallbackUrl) {
      fallbackUrl = fallbackUrl || '/';
      var prevPage = window.location.href;
  
      window.history.go(-1);
  
      setTimeout(function(){ 
          if (window.location.href == prevPage) {
              window.location.href = fallbackUrl; 
          }
      }, 500);
  }
  
  // START Set form controls with querystring values
  document.getElementById("offeris").value = params.get('offeris');
  document.getElementById("beds").value = params.get('beds');
  document.getElementById("baths").value = params.get('baths');
  document.getElementById("gtp").value = params.get('gtp');
  document.getElementById("ltp").value = params.get('ltp');
  document.getElementById("pool").value = params.get('pool');
  // END Set form controls
  
  function getQueryStringValue (key) {  
    return decodeURIComponent(window.location.search.replace(new RegExp("^(?:.*[&\\?]" + encodeURIComponent(key).replace(/[\.\+\*]/g, "\\$&") + "(?:\\=([^&]*))?)?.*$", "i"), "$1"));  
  } 
  
  function QueryData(t,e){if(null==t&&(t=location.search?location.search:""),"?"==t.charAt(0)&&(t=t.substring(1)),t.length>0)for(var n=(t=t.replace(/\+/g," ")).split(/[&;]/g),i=0;i<n.length;i++){var o=n[i].split("="),h=decodeURIComponent(o[0]),s=o.length>1?decodeURIComponent(o[1]):"";e?(h in this||(this[h]=[]),this[h].push(s)):this[h]=s}}
  
  
  //adjust search prices
  function adjustprice(strprice, adjustment){
     adjustedprice = parseInt(strprice) + adjustment;
     return adjustedprice.toString();
  };
  
  //prepare querystring multivalues
  function prepqsmulti(QSPlaces){
    var arrPlaces = decodeURIComponent(QSPlaces).replace(/\%2C/g,",").split(',');
    for(i in arrPlaces){
        arrPlaces[i] = '"'+arrPlaces[i]+'"'
      };
    var strPlaces = arrPlaces.join(', ');
    return strPlaces;
    };
  
    function justlocdetail(QSloc){
      var arrLoc = QSloc.split('|')
      return arrLoc[1]
    };
    
  //get the querystring
  
  fetch('{{ .Site.Params.host}}/biens/index.json')
    .then(function(response) {
      return response.json();
    })
    .then(function(json) {
      console.log('return of the json')
      //console.log(JSON.stringify(json));
      var propsdb = TAFFY(json.data);
      //console.log('thepropsdb '+propsdb)
      var tafqry = [];
      var theqry = ""
      var outputHTML = ""
  //
      var qsData = new QueryData(window.location.search, true);
  // is it a ref search
  // propref
  console.log('qsData.propref '+qsData.propref)
  if(qsData.propref != 'No Ref'){
    tafqry.push('"ref":"'+qsData.propref+'"')
    //console.log(tafqry.join(', '))
    theqry = JSON.parse('{'+tafqry.join(', ')+'}')
    //console.log(theqry)
  
  } else {
  //not ref search
    tafqry.push('"price":{"!is":"SOLD"}')
    theofferis = {"new":"new","resale":"resale","rental":"rental"}
    //var qsData = new QueryData(window.location.search, true);
    if(qsData.offeris != "all" && typeof qsData.offeris !== "undefined"){tafqry.push('"offeris":"'+theofferis[qsData.offeris]+'"')}
    console.log("the offeris is "+qsData.offeris)
    console.log("the gtp is "+qsData.gtp)
    console.log("the ltp is "+qsData.ltp)
    console.log("the pt are "+qsData.pt)
    console.log("the pool is "+qsData.pool)
    if(typeof qsData.pt !== "undefined"){ 
      //,Semidetached%20Villa,Detached%20Villa
      thept.set(qsData.pt)
      if(qsData.pt.indexOf("Villa") > -1){qsData.pt.push('Semidetached Villa','Detached Villa')}
      if(qsData.pt.indexOf("Townhouse") > -1){qsData.pt.push('Townhouse','Quadhouse')}
      tafqry.push('"unitype":'+JSON.stringify(qsData.pt)+'') 
    }
    if (typeof qsData.gtp !== "undefined" && qsData.gtp != ""){
      document.getElementById('gtp').value = qsData.gtp
      tafqry.push('"gtprice":{"gt":'+adjustprice(qsData.gtp,-1)+'}') 
    }
    if((typeof qsData.ltp !== "undefined" && qsData.ltp != "")){
      document.getElementById('ltp').value = qsData.ltp 
      tafqry.push('"ltprice":{"lt":'+adjustprice(qsData.ltp,1)+'}') 
    }
    if(typeof qsData.loc!== "undefined"){ 
      theloc.set(qsData.loc)
      tafqry.push('"location_detail":'+JSON.stringify(qsData.loc)+'') 
    }
    if((typeof qsData.beds !== "undefined" && qsData.beds != "")){
      document.getElementById('beds').value = qsData.beds
      var strbeds = qsData.beds.toString();
      if(strbeds.includes("m")){
        var numbeds = strbeds.replace('m','')
        tafqry.push('"beds":{">=":"'+numbeds+'"}')
      }
      else
      {
        console.log('No m in the beds. gsData.beds = '+qsData['beds'])
        tafqry.push('"beds":"'+qsData.beds+'"')
      }
    }
    if((typeof qsData.baths !== "undefined" && qsData.baths != "")){
      document.getElementById('baths').value = qsData.baths
      tafqry.push('"baths":"'+qsData.baths+'"')
    }
    if (qsData.pool == "on"){
      document.getElementById("pool").checked = true;
      tafqry.push('"pool":{"!is":"Non"}') 
    }
    console.log('this is the joined tafqry '+tafqry.join(', '))
    theqry = JSON.parse('{'+tafqry.join(', ')+'}')
  };
  //{ref:"AP1-2-V7369"}
    var loc_list = ''
  // Query for the data
    //console.log('about to query '+ theqry);
    //for (const [key, value] of Object.entries(theqry)) {
      //console.log(`${key}: ${value}`);
     //}theqry

    propsdb(theqry).each(function (r) {
     console.log(r.location_detail + "!");
     loc_list = loc_list+'\n'+r.location_detail
     
     outputHTML = outputHTML+tmpl("tmpl-demo", r)
  });
    //console.log(loc_list)
    if(outputHTML ==""){outputHTML = "<center><h2> pas trouvé</h2></center>"}//"+findref+"
    document.getElementById("propresults").innerHTML = outputHTML
  });
  </script>
  
  <script type="text/x-tmpl" id="tmpl-demo">  
    <div class="column is-3-desktop is-6-mobile is-4-tablet has-text-centered">
              <div class="card">
               <a href="../biens/[%=o.url%]">
                  <div class="card-content">
                      <div class="card-image">
                      <figure class="image is-4by3">                     
                              <img src="[%=o.thumb%]" alt="[%=o.location_detail%] [%=o.type%] for sale" title="[%=o.location_detail%] [%=o.type%] for sale">
                              [% if (o.salestage == "2") { %] <span class="sold has-text-weight-bold">{{ .Site.Params.sold }}</span>[% } %] 
  
                      
                      </figure>
                  </div>
                      <div class="media">
                            <div class="media-content">
                              <p class="is-size-6 has-text-centered is-uppercase">[%=o.type%]</p>
                              <p class="is-size-7 has-text-centered">[%=o.location_detail%]</p>
                              <p class="is-size-7 has-text-centered"> ref: [%=o.ref%] </p>
                              <!--<p class="is-size-7 has-text-centered">
                                <span><i class="fa fa-bed fa-lg" aria-hidden=true></i> [%=o.beds%] </span>
                                <span><i class="fa fa-bath fa-lg" aria-hidden=true></i> [%=o.baths%] </span>
                              </p> -->
                            </div>
                      </div>
                      </a>
                      <!--
                      <div class="media">
                          <div class="media-content">
                              <p class="title is-5 has-text-centered">[%=o.type%]</p>
                              <p class="subtitle is-6 has-text-centered">[%=o.location_detail%]</p>
                          </div>
                      </div>
                      -->
                      <footer class="card-footer">
                          <p class="card-footer-item">
                              <span class=" is-size-6 is-size-6-mobile">
                                <i class="fa fa-bed fa-lg" aria-hidden="true"></i> [%=o.beds%]
                              </span>
                          </p>
                          <p class="card-footer-item">
                              <span class=" is-size-6 is-size-6-mobile">
                                <i class="fa fa-bath fa-lg" aria-hidden="true"></i> [%=o.baths%]
                              </span>
                          </p>
                          <p class="card-footer-item">
                              <span class="is-size-7 is-size-7-mobile">
                                <i class="fa fa-swimming-pool fa-lg" aria-hidden=true></i> [%=o.pool.replace("community","comm").replace("private","priv").replace("public","publ").replace("no","non")%]
                              </span>
                      </p>
                      </footer>
                      <footer class=card-footer>
                          <p class="card-footer-item price">
                              <span class="is-size-6 is-size-5-mobile has-text-weight-bold"> [%=o.displayprice.replace(",", ".")%] </span>                          
                          </p>
                      </footer>
                   </div>
              </div>
            </div>  
        </script>
  {{ end }}

{{ define "footer" }}
 
{{ end }}

{{ define "more" }}

{{ end }}

{{ define "footer" }}
 
{{ end }}